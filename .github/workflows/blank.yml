name: CPT-ANGULAR-Search-Widget

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  ci:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: CPT-ANGULAR-Search-Widget   # ðŸ‘ˆ change if folder name is different

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 18

      - run: npm install
      - run: npm run build

      - env:
          BLACKDUCK_URL: ${{ secrets.BLACKDUCK_URL }}
          BLACKDUCK_API_TOKEN: ${{ secrets.BLACKDUCK_API_TOKEN }}
        run: |
          curl -s -L https://detect.synopsys.com/detect.sh -o detect.sh
          chmod +x detect.sh
          ./detect.sh \
            --blackduck.url="$BLACKDUCK_URL" \
            --blackduck.api.token="$BLACKDUCK_API_TOKEN" \
            --detect.project.name="CPT-Search Widget UIaaS" \
            --detect.project.version.name="1.20.0" \
            --detect.source.path="."

      - run: |
          sourceanalyzer -b CPT-ANGULAR-Search-Widget -clean
          sourceanalyzer -b CPT-ANGULAR-Search-Widget \
            babel.config.js \
            coverage \
            jest.config.js \
            node_modules \
            package.json \
            package-lock.json \
            public \
            README.md \
            rollup.config.js \
            scripts \
            src
          sourceanalyzer -b CPT-ANGULAR-Search-Widget \
            -scan \
            -f cpt.angular-search-widget1.fpr \
            -verbose \
            -logfile fortify-scan.log

      - if: always()
        env:
          FORTIFY_URL: ${{ secrets.FORTIFY_URL }}
          FORTIFY_TOKEN: ${{ secrets.FORTIFY_TOKEN }}
        run: echo "Replace this with your actual Fortify upload command"
